"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[2884],{3905:(e,n,a)=>{a.d(n,{Zo:()=>p,kt:()=>g});var t=a(7294);function r(e,n,a){return n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function i(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),a.push.apply(a,t)}return a}function l(e){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{};n%2?i(Object(a),!0).forEach((function(n){r(e,n,a[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(a,n))}))}return e}function o(e,n){if(null==e)return{};var a,t,r=function(e,n){if(null==e)return{};var a,t,r={},i=Object.keys(e);for(t=0;t<i.length;t++)a=i[t],n.indexOf(a)>=0||(r[a]=e[a]);return r}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(t=0;t<i.length;t++)a=i[t],n.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=t.createContext({}),d=function(e){var n=t.useContext(s),a=n;return e&&(a="function"==typeof e?e(n):l(l({},n),e)),a},p=function(e){var n=d(e.components);return t.createElement(s.Provider,{value:n},e.children)},u="mdxType",c={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},m=t.forwardRef((function(e,n){var a=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),u=d(a),m=r,g=u["".concat(s,".").concat(m)]||u[m]||c[m]||i;return a?t.createElement(g,l(l({ref:n},p),{},{components:a})):t.createElement(g,l({ref:n},p))}));function g(e,n){var a=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var i=a.length,l=new Array(i);l[0]=m;var o={};for(var s in n)hasOwnProperty.call(n,s)&&(o[s]=n[s]);o.originalType=e,o[u]="string"==typeof e?e:r,l[1]=o;for(var d=2;d<i;d++)l[d]=a[d];return t.createElement.apply(null,l)}return t.createElement.apply(null,a)}m.displayName="MDXCreateElement"},1273:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>s,contentTitle:()=>l,default:()=>c,frontMatter:()=>i,metadata:()=>o,toc:()=>d});var t=a(7462),r=(a(7294),a(3905));const i={title:"GraphQL API",sidebar_position:20},l=void 0,o={unversionedId:"developer/api/graphql-api",id:"developer/api/graphql-api",title:"GraphQL API",description:"GraphQL Console",source:"@site/docs/developer/api/graphql-api.mdx",sourceDirName:"developer/api",slug:"/developer/api/graphql-api",permalink:"/developer/api/graphql-api",draft:!1,editUrl:"https://github.com/steedos/steedos-docs/tree/master/docs/developer/api/graphql-api.mdx",tags:[],version:"current",sidebarPosition:20,frontMatter:{title:"GraphQL API",sidebar_position:20},sidebar:"developer",previous:{title:"API Authentication",permalink:"/developer/api/api-validate"},next:{title:"OpenAPI",permalink:"/developer/api/openapi"}},s={},d=[{value:"GraphQL Console",id:"graphql-console",level:2},{value:"\u63a5\u53e3\u9a8c\u8bc1",id:"\u63a5\u53e3\u9a8c\u8bc1",level:2},{value:"Querying Data",id:"querying-data",level:2},{value:"Querying Objects and Fields",id:"querying-objects-and-fields",level:3},{value:"Query parameter: Pagination",id:"query-parameter-pagination",level:3},{value:"Query parameter: Sorting",id:"query-parameter-sorting",level:3},{value:"Query parameter: Filtering",id:"query-parameter-filtering",level:3},{value:"Expanding Related Tables in Query",id:"expanding-related-tables-in-query",level:3},{value:"Returning formatted data",id:"returning-formatted-data",level:3},{value:"Querying Related Subtables",id:"querying-related-subtables",level:3},{value:"Working with Data",id:"working-with-data",level:2},{value:"Creating Data",id:"creating-data",level:3},{value:"Creating a Single Record",id:"creating-a-single-record",level:4},{value:"Modifying record",id:"modifying-record",level:3},{value:"Modifying a single record",id:"modifying-a-single-record",level:4},{value:"Deleting record",id:"deleting-record",level:3},{value:"Deleting a single record",id:"deleting-a-single-record",level:4}],p={toc:d},u="wrapper";function c(e){let{components:n,...a}=e;return(0,r.kt)(u,(0,t.Z)({},p,a,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"graphql-console"},"GraphQL Console"),(0,r.kt)("p",null,"The GraphQL console can be accessed on the browser to query and manipulate data in the system. The website address is: ${server_address}/graphql."),(0,r.kt)("p",null,"GraphQL interface has built-in access control. Before executing a query, you must first log in to the system. The query's access permission is based on the current logged-in account."),(0,r.kt)("p",null," ",(0,r.kt)("img",{parentName:"p",src:"https://console.steedos.cn/api/files/images/BTmifmnQCm98HdZ7L",alt:null})),(0,r.kt)("h2",{id:"\u63a5\u53e3\u9a8c\u8bc1"},"\u63a5\u53e3\u9a8c\u8bc1"),(0,r.kt)("p",null,"Before calling an interface, interface authentication must first be performed. Please refer to ",(0,r.kt)("a",{parentName:"p",href:"./api-validate"},"Interface Verification."),"\u3002"),(0,r.kt)("h2",{id:"querying-data"},"Querying Data"),(0,r.kt)("p",null,"When using GraphQL to query data, you can set the object, field, pagination, sorting, and filtering conditions to be queried. All queries are based on the range of data authorized for viewing by the currently logged-in user."),(0,r.kt)("h3",{id:"querying-objects-and-fields"},"Querying Objects and Fields"),(0,r.kt)("p",null,"By inputting the object and field names, you can query all records in the object. For example, the following query can query information about branches."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"{\n  company{\n    _id,\n    name,\n    admins\n  } \n}\n")),(0,r.kt)("p",null,"and return"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'{\n  "data": {\n    "company": [\n      {\n        "_id": "CqY8Dy4MCFgXCbMjT",\n        "name": "\u534e\u708e\u8f6f\u4ef6",\n        "admins": [\n          "60f6a630d5d0f30031bba318"\n        ]\n      },\n      {\n        "_id": "EX4Ro64TjLaMnves8",\n        "name": "\u534e\u708e\u7f51\u7edc",\n        "admins": [\n          "60f6a630d5d0f30031bba318"\n        ]\n      }\n    ]\n  }\n}\n')),(0,r.kt)("h3",{id:"query-parameter-pagination"},"Query parameter: Pagination"),(0,r.kt)("p",null,"You can define a skip parameter to specify how many records to skip, and a top parameter to specify how many records to return in a query."),(0,r.kt)("p",null,"The following query will only return the second record:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"query{\n  space_users(top:1, skip:1){\n    name,\n    mobile\n  }\n}\n")),(0,r.kt)("h3",{id:"query-parameter-sorting"},"Query parameter: Sorting"),(0,r.kt)("p",null,"You can define how to sort the results using the sort parameter."),(0,r.kt)("p",null,"The keyword desc indicates descending order, and the keyword asc indicates ascending order."),(0,r.kt)("p",null,"Example: Sorting in descending order by the field name."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'query{\n  space_users(sort:"name asc"){\n    name,\n    mobile\n  }\n}\n')),(0,r.kt)("h3",{id:"query-parameter-filtering"},"Query parameter: Filtering"),(0,r.kt)("p",null,"You can add filters to query for specific records."),(0,r.kt)("p",null,"Example: Query records where the branch name contains 'steedos'."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'query{\n  company(filters: ["name","contains","steedos"]){\n    _id,\n    name,\n  } \n}\n')),(0,r.kt)("h3",{id:"expanding-related-tables-in-query"},"Expanding Related Tables in Query"),(0,r.kt)("p",null,"For lookup and master/detail type fields, you can use the ${field_api_name}__expand syntax to expand the query to include data from related tables. If the related table field is a multi-select type, the returned data will also be an array."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"{\n  company{\n    _id,\n    name,\n    admins__expand{\n      name\n      mobile\n    }\n  } \n}\n")),(0,r.kt)("p",null,"and return"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'{\n  "data": {\n    "company": [\n      {\n        "_id": "CqY8Dy4MCFgXCbMjT",\n        "name": "\u534e\u708e\u8f6f\u4ef6",\n        "admins__expand": [\n          {\n            "_id": "60f6a630d5d0f30031bba318",\n            "name": "\u7ba1\u7406\u5458",\n            "mobile": "18600000000"\n          }\n        ]\n      }\n    ]\n  }\n}\n')),(0,r.kt)("h3",{id:"returning-formatted-data"},"Returning formatted data"),(0,r.kt)("p",null,"For boolean, select, date, datetime, and lookup type fields, you can use the _display{field_api_name} syntax to format the queried data."),(0,r.kt)("p",null,"In the formatted result, the values of 0, null, and false will be replaced with an empty string."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"query{\n  space_users(top:1, skip:1){\n    name,\n    # boolean null\n    email_verified\n    # boolean false\n    mobile_verified\n    # boolean true\n    is_supplier\n    # lookup  \u5355\u9009\n    organization\n    # lookup  \u591a\u9009\n    organizations_parents\n    # select\n    locale\n    # number\n    sort_no\n    # date\n    last_logon\n    # datetime\n    created\n    \n    _display{\n      email_verified\n      mobile_verified\n      is_supplier\n      organization\n      organizations_parents\n      locale\n      sort_no\n      last_logon\n      created\n    },\n    _ui{\n      organization\n      organizations_parents\n    }\n  }\n}\n")),(0,r.kt)("p",null,"and return"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'{\n  "data": {\n    "space_users": [\n      {\n        "name": "\u738b\u5c0f\u660e",\n        "email_verified": null,\n        "mobile_verified": false,\n        "is_supplier": null,\n        "organization": "n7Yv6i5fg3acnmm5d",\n        "organizations_parents": [\n          "n7Yv6i5fg3acnmm5d",\n          "XypyNbzGCJbHMNyWv"\n        ],\n        "locale": "zh-cn",\n        "sort_no": null,\n        "last_logon": null,\n        "created": "2022-08-09T04:08:28.313Z",\n        "_display": {\n          "email_verified": "",\n          "mobile_verified": "",\n          "is_supplier": "",\n          "organization": "\u4e0a\u6d77\u5206\u516c\u53f8",\n          "organizations_parents": "\u4e0a\u6d77\u5206\u516c\u53f8,\u7231\u591a\u90a6",\n          "locale": "\u7b80\u4f53\u4e2d\u6587",\n          "sort_no": "",\n          "last_logon": "",\n          "created": "2022-08-09 12:08"\n        },\n        "_ui": {\n          "organization": {\n            "objectName": "organizations",\n            "value": "n7Yv6i5fg3acnmm5d",\n            "label": "\u4e0a\u6d77\u5206\u516c\u53f8"\n          },\n          "organizations_parents": [\n            {\n              "objectName": "organizations",\n              "value": "n7Yv6i5fg3acnmm5d",\n              "label": "\u4e0a\u6d77\u5206\u516c\u53f8"\n            },\n            {\n              "objectName": "organizations",\n              "value": "XypyNbzGCJbHMNyWv",\n              "label": "\u7231\u591a\u90a6"\n            }\n          ]\n        }\n      }\n    ]\n  }\n}\n')),(0,r.kt)("h3",{id:"querying-related-subtables"},"Querying Related Subtables"),(0,r.kt)("p",null,"When other tables are related to the current table, you can query the related subtable information at the same time."),(0,r.kt)("p",null,"Query Syntax:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"_related_${object_api_name}_${field_api_name}\n")),(0,r.kt)("p",null,'For example, the following query can retrieve a list of personnel within the current division, i.e. the records in the "space_users" object where the "company_ids" field is associated with the "company":'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'{\n  company{\n    _id,\n    name,\n    admins__expand{\n      _id\n      name\n      mobile\n    }\n    space_users: _related_space_users_company_ids(filters: ["job_number","=","10"]) {\n      name\n      mobile\n    }\n  } \n}\n')),(0,r.kt)("p",null,'Note: For the purpose of enhancing the readability of the returned results, an alias named "space_users" is used for the returned results.'),(0,r.kt)("p",null,"and return"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'{\n  "data": {\n    "company": [\n      {\n        "_id": "CqY8Dy4MCFgXCbMjT",\n        "name": "\u534e\u708e\u8f6f\u4ef6",\n        "admins__expand": [\n          {\n            "_id": "60f6a630d5d0f30031bba318",\n            "name": "\u7ba1\u7406\u5458",\n            "mobile": "18600000000"\n          }\n        ],\n        "space_users": [\n          {\n            "name": "\u5c0f\u660e",\n            "mobile": "18600000000"\n          }\n        ]\n      }\n    ]\n  }\n}\n')),(0,r.kt)("h2",{id:"working-with-data"},"Working with Data"),(0,r.kt)("p",null,"GraphQL can be utilized to perform CRUD (Create, Retrieve, Update, Delete) operations on data. All data-related operations are executed based on the current user's authorized data scope."),(0,r.kt)("h3",{id:"creating-data"},"Creating Data"),(0,r.kt)("p",null,"When calling the GraphQL API to create new data, the system first verifies whether the current user has the permission to perform the corresponding create action."),(0,r.kt)("h4",{id:"creating-a-single-record"},"Creating a Single Record"),(0,r.kt)("p",null,"To create a single record, use the syntax mutation.{object_api_name}__insert and provide the value for the doc parameter."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'mutation {\n  tasks__insert(doc:{name:"Task One", assignees: []}) {\n    name\n    _id\n  }\n}\n')),(0,r.kt)("p",null,'In this case, tasks represents the object name of the record you want to insert, and {name:"Task One", assignees: []} represents the JSON data to be inserted.'),(0,r.kt)("p",null,"The keyword __insert indicates that a record will be added to the system via the GraphQL API."),(0,r.kt)("p",null,"and return"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'{\n  "data": {\n    "tasks__insert": {\n      "name": "Task One",\n      "_id": "5cb98489d09a343e14daae95"\n    }\n  }\n}\n')),(0,r.kt)("h3",{id:"modifying-record"},"Modifying record"),(0,r.kt)("p",null,"When calling the GraphQL API to modify data, the system first verifies whether the current user has the corresponding edit permissions."),(0,r.kt)("h4",{id:"modifying-a-single-record"},"Modifying a single record"),(0,r.kt)("p",null,"To modify a single record, use the syntax mutation.{object_api_name}__update and provide the values for the id and doc parameters."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'mutation {\n  tasks__update(id:"5cb98489d09a343e14daae95", doc:{name:"Task Important"}) {\n    name\n    _id\n  }\n}\n')),(0,r.kt)("p",null,'In this case, tasks represents the object name of the record you want to modify, the value 5cb98489d09a343e14daae95 for id represents the _id of the record you want to modify, and {name:"Task Important"} represents the JSON data to be updated.'),(0,r.kt)("p",null,"The keyword __update indicates that a record will be updated in the system via the GraphQL API."),(0,r.kt)("p",null,"and return"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'{\n  "data": {\n    "tasks__update": {\n      "name": "Task Important",\n      "_id": "5cb98489d09a343e14daae95"\n    }\n  }\n}\n')),(0,r.kt)("h3",{id:"deleting-record"},"Deleting record"),(0,r.kt)("p",null,"When calling the GraphQL API to delete data, the system will first verify if the current user has the corresponding deletion permissions."),(0,r.kt)("h4",{id:"deleting-a-single-record"},"Deleting a single record"),(0,r.kt)("p",null,"To delete a single piece of data, use the mutation.{object_api_name}__delete syntax and provide the id parameter value."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'mutation {\n  tasks__delete(id:"5cb98489d09a343e14daae95")\n}\n')),(0,r.kt)("p",null,"In which tasks represents the name of the object to delete a record from, and the value 5cb98489d09a343e14daae95 of id represents the _id of the record to be deleted."),(0,r.kt)("p",null,"The keyword __delete represents deleting a record in the system through the GraphQL API."),(0,r.kt)("p",null,"and return"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},'{\n  "data": {\n    "tasks__delete": 1\n  }\n}\n')),(0,r.kt)("p",null,"Reference to\uff1a",(0,r.kt)("a",{parentName:"p",href:"https://graphql.org/"},"GraphQL")))}c.isMDXComponent=!0}}]);