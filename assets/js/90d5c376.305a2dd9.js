"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[770],{3905:(e,n,t)=>{t.d(n,{Zo:()=>u,kt:()=>_});var o=t(67294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function r(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,o,a=function(e,n){if(null==e)return{};var t,o,a={},i=Object.keys(e);for(o=0;o<i.length;o++)t=i[o],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)t=i[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var s=o.createContext({}),c=function(e){var n=o.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):r(r({},n),e)),t},u=function(e){var n=c(e.components);return o.createElement(s.Provider,{value:n},e.children)},E="mdxType",d={inlineCode:"code",wrapper:function(e){var n=e.children;return o.createElement(o.Fragment,{},n)}},p=o.forwardRef((function(e,n){var t=e.components,a=e.mdxType,i=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),E=c(t),p=a,_=E["".concat(s,".").concat(p)]||E[p]||d[p]||i;return t?o.createElement(_,r(r({ref:n},u),{},{components:t})):o.createElement(_,r({ref:n},u))}));function _(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var i=t.length,r=new Array(i);r[0]=p;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l[E]="string"==typeof e?e:a,r[1]=l;for(var c=2;c<i;c++)r[c]=t[c];return o.createElement.apply(null,r)}return o.createElement.apply(null,t)}p.displayName="MDXCreateElement"},57488:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>r,default:()=>d,frontMatter:()=>i,metadata:()=>l,toc:()=>c});var o=t(87462),a=(t(67294),t(3905));const i={title:"Instance Configuration"},r=void 0,l={unversionedId:"deploy/steedos-config",id:"deploy/steedos-config",title:"Instance Configuration",description:"This page provides instructions on how to configure your self-hosted Steedos instance.",source:"@site/docs/deploy/steedos-config.md",sourceDirName:"deploy",slug:"/deploy/steedos-config",permalink:"/deploy/steedos-config",draft:!1,editUrl:"https://github.com/steedos/steedos-docs/tree/master/docs/deploy/steedos-config.md",tags:[],version:"current",frontMatter:{title:"Instance Configuration"},sidebar:"platform",previous:{title:"Try with Gitpod",permalink:"/deploy/gitpod"},next:{title:"Building Applications",permalink:"/no-code/application/"}},s={},c=[{value:"Required Configuration",id:"required-configuration",level:2},{value:"Login Screen",id:"login-screen",level:2},{value:"Attachment Storage",id:"attachment-storage",level:2},{value:"Local File System",id:"local-file-system",level:3},{value:"S3",id:"s3",level:3},{value:"Attachment Anonymous Download",id:"attachment-anonymous-download",level:3},{value:"Push Notifications",id:"push-notifications",level:2},{value:"Email Configuration",id:"email-configuration",level:2},{value:"OIDC Authentication",id:"oidc-authentication",level:2},{value:"Scheduled Tasks",id:"scheduled-tasks",level:2},{value:"Developer Options",id:"developer-options",level:2},{value:"Account-related",id:"account-related",level:2},{value:"Password Policy Configuration",id:"password-policy-configuration",level:2}],u={toc:c},E="wrapper";function d(e){let{components:n,...t}=e;return(0,a.kt)(E,(0,o.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"This page provides instructions on how to configure your self-hosted Steedos instance."),(0,a.kt)("h2",{id:"required-configuration"},"Required Configuration"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"# Platform\nPORT=80\nROOT_URL=http://localhost\n\n# Database\nMONGO_URL=mongodb://127.0.0.1:27017/steedos\nMONGO_OPLOG_URL=mongodb://127.0.0.1:27017/local\n\n# Microservices communication [https://moleculer.services/docs/0.14/networking.html](https://moleculer.services/zh/docs/0.14/networking.html)\nTRANSPORTER=redis://127.0.0.1:6379\n\n# Caching https://moleculer.services/zh/docs/0.14/caching.html\nCACHER=redis://127.0.0.1:6379/1\n\n")),(0,a.kt)("h2",{id:"login-screen"},"Login Screen"),(0,a.kt)("p",null,"Configure login screen related parameters, such as whether registration is allowed, whether password modification is permitted, whether company creation is allowed."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"# Allow account creation, default is true when the database is empty\nSTEEDOS_TENANT_ENABLE_REGISTER=true  \n# Allow password recovery, setting to true will display a link to retrieve the password, default is false.\nSTEEDOS_TENANT_ENABLE_FORGET_PASSWORD=true  \n# Allow creation of companies, by default only allowed when the database is empty\nSTEEDOS_TENANT_ENABLE_CREATE_TENANT=false \n# Allow password login, enabled by default for both registration and login. Default is true\nSTEEDOS_TENANT_ENABLE_PASSWORD_LOGIN=true \n# Mandatory email binding, email input and verification required after login. Default is false\nSTEEDOS_TENANT_ENABLE_BIND_EMAIL=false \n# Mandatory mobile number binding, mobile number input and verification required after login. Default is false\nSTEEDOS_TENANT_ENABLE_BIND_MOBILE=false \n# Allow login using email verification code, default method for both registration and login when enabled.\nSTEEDOS_TENANT_ENABLE_EMAIL_CODE_LOGIN=false \n# Allow login using mobile verification code, default method for both registration and login when enabled.\nSTEEDOS_TENANT_ENABLE_MOBILE_CODE_LOGIN=false \n# Default is a 43-character string, a new value is generated each time the service is restarted\nSTEEDOS_TENANT_TOKEN_SECRET=  \n# Default is 90d\nSTEEDOS_TENANT_ACCESS_TOKEN_EXPIRES_IN= \n# Default is 7d\nSTEEDOS_TENANT_REFRESH_TOKEN_EXPIRES_IN=  \n")),(0,a.kt)("h1",{id:"metadata-synchronization"},"Metadata Synchronization"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"METADATA_SERVER=http://localhost:5000\nMETADATA_APIKEY=\n")),(0,a.kt)("h2",{id:"attachment-storage"},"Attachment Storage"),(0,a.kt)("p",null,"Configure parameters related to attachment storage."),(0,a.kt)("h3",{id:"local-file-system"},"Local File System"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"STEEDOS_CFS_STORE=local\nSTEEDOS_STORAGE_DIR=/steedos-storage\n")),(0,a.kt)("h3",{id:"s3"},"S3"),(0,a.kt)("p",null,"Attachments can be stored on servers supporting the S3 protocol, including AWS, Alibaba Cloud, Tencent Cloud storage services, or privately deployed minio services."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"STEEDOS_CFS_STORE=S3\nSTEEDOS_CFS_AWS_S3_ENDPOINT=http://minio:9000\nSTEEDOS_CFS_AWS_S3_FORCE_PATH_STYLE=true\nSTEEDOS_CFS_AWS_S3_BUCKET=steedos-prod\nSTEEDOS_CFS_AWS_S3_ACCESS_KEY_ID=${MINIO_ROOT_USER:-steedos} \nSTEEDOS_CFS_AWS_S3_SECRET_ACCESS_KEY=${MINIO_ROOT_PASSWORD:-steedos123}\n")),(0,a.kt)("h3",{id:"attachment-anonymous-download"},"Attachment Anonymous Download"),(0,a.kt)("p",null,"By default, uploaded avatars, images, and attachments in the system require login for download."),(0,a.kt)("p",null,"The following variable can be set for anonymous downloads."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"# Options include avatars, images, files, default is avatars\nSTEEDOS_CFS_DOWNLOAD_PUBLIC=avatars,images \n")),(0,a.kt)("h2",{id:"push-notifications"},"Push Notifications"),(0,a.kt)("p",null,"Configure parameters for mobile push notifications, used for receiving notification messages on the Steedos mobile app."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"# iOS\nSTEEDOS_PUSH_APN_DATA=\n\n# Andriod\nSTEEDOS_GCM_APIKEY=\nSTEEDOS_GCM_PROJECT_NUMBER=\n\n# Huawei\nSTEEDOS_PUSH_HUAWEI_APPID=\nSTEEDOS_PUSH_HUAWEI_APPPKGNAME=\nSTEEDOS_PUSH_HUAWEI_APPSECRET=\n\n# Xiaomi\nSTEEDOS_PUSH_MI_APPSECRET=\nSTEEDOS_PUSH_MI_PRODUCTION=\n")),(0,a.kt)("h2",{id:"email-configuration"},"Email Configuration"),(0,a.kt)("p",null,"Configure SMTP service parameters for system push emails."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"STEEDOS_EMAIL_FROM=\nSTEEDOS_EMAIL_URL=\nSTEEDOS_EMAIL_HOST=\nSTEEDOS_EMAIL_PORT=\nSTEEDOS_EMAIL_USERNAME=\nSTEEDOS_EMAIL_PASSWORD=\nSTEEDOS_EMAIL_SECURE=\nSTEEDOS_EMAIL_SIGNNAME=\n")),(0,a.kt)("h2",{id:"oidc-authentication"},"OIDC Authentication"),(0,a.kt)("p",null,"Enterprise Edition: Configure parameters for OpenID Connect single sign-on, can connect to Keycloak server."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"# OpenID Connect\nSTEEDOS_IDENTITY_OIDC_ENABLED=true\nSTEEDOS_IDENTITY_OIDC_CONFIG_URL=https://id.steedos.cn/realms/master/.well-known/openid-configuration\nSTEEDOS_IDENTITY_OIDC_CLIENT_ID=steedos-oidc-public\nSTEEDOS_IDENTITY_OIDC_CLIENT_SECRET=none\nSTEEDOS_IDENTITY_OIDC_NAME=Steedos ID\nSTEEDOS_IDENTITY_OIDC_LOGO=\nSTEEDOS_IDENTITY_OIDC_REQUIRE_LOCAL_ACCOUNT=false\n")),(0,a.kt)("h2",{id:"scheduled-tasks"},"Scheduled Tasks"),(0,a.kt)("p",null,"Configure the properties for scheduled tasks."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"# Time to execute database indexing, like \u201c0 0 * * * *\u201d above means indexing operation is performed once every hour. Existing indexes are not recreated.\nSTEEDOS_CRON_BUILD_INDEX=\"0 0 * * * *\"\n\n# Execution time for workflow rule queue, time-based workflow actions depend on this configuration, like \u201c*/10 * * * * *\u201d above means it's executed every 1 minutes.\nSTEEDOS_CRON_WORKFLOW_RULE='*/1 * * * *'\n\n# Polling interval for the mail queue, in milliseconds.\nSTEEDOS_CRON_MAILQUEUE_INTERVAL=10000\n\n# Polling interval for the push notification queue, in milliseconds.\nSTEEDOS_CRON_PUSH_INTERVAL=1000\n\n# Polling interval for the webhook queue, in milliseconds.\nSTEEDOS_CRON_WEBHOOKQUEUE_INTERVAL=10000\n\n# Polling interval for the instance record queue, in milliseconds.\nSTEEDOS_CRON_INSTANCERECORDQUEUE_INTERVAL=10000\n\n# Polling interval for the SMS queue, in milliseconds.\nSTEEDOS_CRON_SMSQUEUE_INTERVAL=1000\n\n# Polling interval for the object webhooks queue, in milliseconds.\nSTEEDOS_CRON_OBJECTWEBHOOKSQUEUE_INTERVAL=10000\n\n# Polling interval of the object & workflow synchronization queue, in milliseconds.\nSTEEDOS_CRON_INSTANCERECORDQUEUE_INTERVAL=10000\n")),(0,a.kt)("h2",{id:"developer-options"},"Developer Options"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"STEEDOS_GRAPHQL_ENABLE_CONSOLE=true\nSTEEDOS_UNPKG_URL=https://unpkg.steedos.cn\nSTEEDOS_AMIS_VERSION=2.9.0\nSTEEDOS_PUBLIC_PAGE_ASSETURLS=http://127.0.0.1:8080/@steedos-widgets/amis-object/dist/assets-dev.json\nSTEEDOS_ENABLE_PROCESS_TRIGGER=true\n")),(0,a.kt)("h2",{id:"account-related"},"Account-related"),(0,a.kt)("p",null,"Configure parameters related to accounts."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},"accounts:\n  mobile_phone_locales: ['zh-CN']\n  mobile_regexp: '^[0-9]{11}$'\n  is_username_skip_minrequiredlength: true\n  UTF8_Names_Validation: '[A-Za-z0-9-_.\\u00C0-\\u017F\\u4e00-\\u9fa5]'\n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"mobile_phone_locales: This parameter takes precedence. Mobile phone localization, setting it to ",(0,a.kt)("inlineCode",{parentName:"li"},"zh-CN")," means using the 11-digit mobile number in China. To support mobile numbers from other countries, please refer to ",(0,a.kt)("a",{parentName:"li",href:"https://www.npmjs.com/package/validator"},"validator"),"."),(0,a.kt)("li",{parentName:"ul"},"mobile_regexp: Regular expression for mobile phone format, using a regular expression to describe the correct mobile phone format."),(0,a.kt)("li",{parentName:"ul"},"is_username_skip_minrequiredlength: Whether to skip the minimum character requirement for usernames, which is typically 6 characters by default."),(0,a.kt)("li",{parentName:"ul"},"UTF8_Names_Validation: Regular expression for username rules.")),(0,a.kt)("h2",{id:"password-policy-configuration"},"Password Policy Configuration"),(0,a.kt)("p",null,"The complexity of passwords is controlled through the password.policy attribute, which takes a regular expression as its value."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},'public:\n  password:\n    policy: ^[A-Za-z0-9]{8,}$\n    policyError: "Password cannot be less than 8 characters"\n    policies:\n      - policy: 123\n        policyError: "Password must include 123"\n      - policy: 456\n        policyError: "Password must include 456"\n    policyFunction: !\n      function(password){\n        if(password === \'12345678\'){\n          throw new Error(\'Password cannot be 12345678\');\n        }\n      }\n')),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"public.password.policyFunction: string Function. Custom validation function (1 parameter: the user-entered password), you can import validation libraries or directly write validation rules. If the password does not meet the rules, throw an error directly."),(0,a.kt)("li",{parentName:"ul"},"public.password.policies: Array<{policy: 'regular expression', policyError: 'error message when the expression is not met'}>")),(0,a.kt)("p",null,"When multiple password rules are configured, they will take effect simultaneously. The rules in the example above are effective at the same time."))}d.isMDXComponent=!0}}]);