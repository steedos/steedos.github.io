"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[1107],{2990:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>r,default:()=>h,frontMatter:()=>i,metadata:()=>a,toc:()=>c});var s=t(74848),o=t(28453);const i={title:"Node-Red"},r=void 0,a={id:"developer/integration/node-red",title:"Node-Red",description:"Node-RED is a process-oriented programming tool that allows you to effortlessly connect IoT devices, APIs and online services together. It employs a browser-based editor which allows users to drag and drop different nodes onto a canvas, and connect them to create a flow. Node-RED also offers a plethora of nodes which enable users to easily interact with a diverse range of devices and services.https://Node-Red.org/\u3002",source:"@site/docs/developer/integration/node-red.mdx",sourceDirName:"developer/integration",slug:"/developer/integration/node-red",permalink:"/developer/integration/node-red",draft:!1,unlisted:!1,editUrl:"https://github.com/steedos/steedos-docs/tree/master/docs/developer/integration/node-red.mdx",tags:[],version:"current",frontMatter:{title:"Node-Red"},sidebar:"developer",previous:{title:"SSO API",permalink:"/developer/integration/api-jwt-sso"}},d={},c=[{value:"Integrating a Node-RED project",id:"integrating-a-node-red-project",level:2},{value:"Developing an application",id:"developing-an-application",level:3},{value:"Executing",id:"executing",level:3},{value:"Static Resource Storage",id:"static-resource-storage",level:3},{value:"Initialization Configuration",id:"initialization-configuration",level:3},{value:"Flow Designer",id:"flow-designer",level:2},{value:"Steedos Node",id:"steedos-node",level:2},{value:"steedos-event",id:"steedos-event",level:3},{value:"steedos-emit",id:"steedos-emit",level:3},{value:"steedos-call",id:"steedos-call",level:3},{value:"steedos-request",id:"steedos-request",level:3},{value:"steedos-response",id:"steedos-response",level:3},{value:"steedos-api-gw",id:"steedos-api-gw",level:3},{value:"steedos-instance",id:"steedos-instance",level:3},{value:"To invoke GraphQL",id:"to-invoke-graphql",level:2},{value:"To invoke ObjectQL",id:"to-invoke-objectql",level:2},{value:"Invoke using msg.call",id:"invoke-using-msgcall",level:3},{value:"Invoke using a broker",id:"invoke-using-a-broker",level:3},{value:"Trigger",id:"trigger",level:2}];function l(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.p,{children:["Node-RED is a process-oriented programming tool that allows you to effortlessly connect IoT devices, APIs and online services together. It employs a browser-based editor which allows users to drag and drop different nodes onto a canvas, and connect them to create a flow. Node-RED also offers a plethora of nodes which enable users to easily interact with a diverse range of devices and services.",(0,s.jsx)(n.a,{href:"https://node-red.org/",children:"https://Node-Red.org/"}),"\u3002"]}),"\n",(0,s.jsx)(n.h2,{id:"integrating-a-node-red-project",children:"Integrating a Node-RED project"}),"\n",(0,s.jsx)(n.h3,{id:"developing-an-application",children:"Developing an application"}),"\n",(0,s.jsxs)(n.p,{children:["Reference to\uff1a",(0,s.jsx)(n.a,{href:"https://gitlab.steedos.cn/steedos/steedos-project-template.git",children:"steedos-project-template.git"})]}),"\n",(0,s.jsx)(n.h3,{id:"executing",children:"Executing"}),"\n",(0,s.jsx)(n.p,{children:"We can see the package.json file in the newly created node-red-app folder, which is an independent NPM project. To run the Node-Red project, we need to cd to that folder, execute yarn to install the project dependencies, and finally execute yarn start."}),"\n",(0,s.jsx)(n.p,{children:"Once running successfully, the service can be accessed through the address with port 1880."}),"\n",(0,s.jsx)(n.h3,{id:"static-resource-storage",children:"Static Resource Storage"}),"\n",(0,s.jsx)(n.p,{children:'we need to store static resources, we can create a static resource directory under the node-red-app folder with a self-chosen file name. Here, we use "public" as an example. At the same time, add the following code to the setting.js file under the node-red-app folder\uff1a'}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-jsx",children:"httpStatic: path.join(__dirname, 'public'),\n    httpAdminRoot: \"/admin\"\n\n"})}),"\n",(0,s.jsx)(n.p,{children:"example\uff1a"}),"\n",(0,s.jsxs)(n.p,{children:['To access the stored resources, the URL only needs to be accessed using "/". The URL for the Node-Red control page has been changed to:',(0,s.jsx)(n.a,{href:"http://127.0.0.1:1880/admin",children:"http://127.0.0.1:1880/admin"})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:t(89892).A+"",width:"1089",height:"530"})}),"\n",(0,s.jsx)(n.h3,{id:"initialization-configuration",children:"Initialization Configuration"}),"\n",(0,s.jsx)(n.p,{children:"After running the Node-Red service, we can access the Node-Red by entering the address displayed on the console in a browser. Upon the first access to the service, we will see an initialization configuration wizard interface, where we can set up the account and password for accessing the Node-Red service, etc. We only need to follow the prompts to complete the configuration."}),"\n",(0,s.jsx)(n.p,{children:'After completing the initialization configuration, we will be automatically redirected to the homepage named "Node-RED on Steedos". On this page, we can see a tutorial on how to customize Node-Red.'}),"\n",(0,s.jsx)(n.h2,{id:"flow-designer",children:"Flow Designer"}),"\n",(0,s.jsxs)(n.p,{children:['On the homepage of the running Node-Red service, we can see a button named "Go to your Node-RED flow editor" on the right side. Clicking on it will open an editor named "Flow Builder". We can access the official Node-Red website tutorial at \xa0',(0,s.jsx)(n.a,{href:"https://node-red.org/docs/user-guide/",children:"https://Node-Red.org/docs/user-guide/"}),"\xa0 to learn how to configure, debug, and deploy flows in the editor."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:t(17605).A+"",width:"1036",height:"627"})}),"\n",(0,s.jsx)(n.h2,{id:"steedos-node",children:"Steedos Node"}),"\n",(0,s.jsx)(n.p,{children:"We can use the aforementioned Flow Designer to configure the integration of existing business systems. If we need to connect mainstream business systems such as SAP, UFIDA, and Kingdee to integrate related businesses into Steedos, we can use a variety of nodes specially developed by us, which can easily realize various integration business requirements."}),"\n",(0,s.jsx)(n.h3,{id:"steedos-event",children:"steedos-event"}),"\n",(0,s.jsx)(n.p,{children:"Steedos Event refers to the function of event subscription and publication using the Steedos Event service in the Steedos platform. Through Steedos Event, we can subscribe to specific events, such as record creation, update or deletion events, in order to execute custom operations when the events occur. In Steedos Event, we need to specify the following parameters:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"Broker"}),"\xa0\uff1aa parameter used in Node-RED to specify the message broker used. In Node-RED, we can connect to Steedos projects by configuring the broker. Usually, NATS is used as the message broker. To configure the broker, we need to make corresponding configurations in the .env file under the Node-RED-app folder and reference it in Node-RED. For more details about NATS as a message broker, please refer to the following link:",(0,s.jsx)(n.a,{href:"https://moleculer.services/zh/docs/0.14/networking.html#NATS-Transporter%E3%80%82",children:"https://moleculer.services/zh/docs/0.14/networking.html#NATS-Transporter\u3002"})]}),"\n",(0,s.jsx)(n.li,{children:"Service\uff1aspecifies the name of the service used."}),"\n",(0,s.jsx)(n.li,{children:"Name\uff1aspecifies the name of the node, such as the name of the node subscribing to events."}),"\n",(0,s.jsx)(n.li,{children:"Topic\uff1aspecifies the topic or event name to subscribe to, such as creating records or updating records."}),"\n",(0,s.jsx)(n.li,{children:"Group\uff1aspecifies the group where events are subscribed, which can be one or more groups separated by commas."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"By configuring these parameters, we can use Steedos Event in the Steedos platform to implement the function of event subscription and publication, so as to execute custom operations when events occur. For example, we can subscribe to record creation events, and send notifications to Slack or WeChat when events occur, or execute custom JavaScript code when events occur to achieve more complex operations."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:t(90803).A+"",width:"506",height:"417"})}),"\n",(0,s.jsx)(n.h3,{id:"steedos-emit",children:"steedos-emit"}),"\n",(0,s.jsx)(n.p,{children:"Steedos Emit is a node within Node-RED, used for sending event messages to the Steedos project. This node requires the following parameters to be configured:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Broker: Specifies the name of the message broker being used;"}),"\n",(0,s.jsx)(n.li,{children:"Name: Specifies the name of the node;"}),"\n",(0,s.jsx)(n.li,{children:"Topic: Specifies the event topic/name, which can be overridden by msg.topic;"}),"\n",(0,s.jsx)(n.li,{children:"Broadcast: Specifies whether the event should be broadcast, which can be overridden by msg.broadcast;"}),"\n",(0,s.jsx)(n.li,{children:"Group: Specifies the group(s) to which the event belongs, with multiple group names separated by commas. This can be overridden by msg.group."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"By configuring these parameters, we can use the Steedos Emit node in Node-RED to send event messages to the Steedos project, enabling communication between different components."}),"\n",(0,s.jsx)(n.h3,{id:"steedos-call",children:"steedos-call"}),"\n",(0,s.jsx)(n.p,{children:"Steedos Call is a Node-RED node used for invoking the APIs provided by the Steedos platform. It can invoke the APIs of the Steedos platform by configuring Broker and Action. The value of Action can also be overridden by the msg.action property. Additionally, some JSON format options can be set in Options to better control the behavior of API invocation. For more information on the APIs provided by the Steedos platform, please refer to the API documentation of the Steedos platform. You can find more information about this in the steedos-template project."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:t(62738).A+"",width:"1408",height:"680"})}),"\n",(0,s.jsx)(n.h3,{id:"steedos-request",children:"steedos-request"}),"\n",(0,s.jsx)(n.p,{children:"Steedos Request is a Node-RED node used for sending HTTP requests to the ObjectQL microservices and GraphQL microservices of the Steedos platform. This node requires the following parameters to be configured:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Broker: Message broker."}),"\n",(0,s.jsx)(n.li,{children:"Service: Name of the microservice to be called."}),"\n",(0,s.jsx)(n.li,{children:"Name: The name of the node, used to identify the node within Node-RED."}),"\n",(0,s.jsx)(n.li,{children:"Action: The name of the operation to be performed, such as querying, creating, updating, or deleting objects. If the msg.action property is included in the message, it will override this parameter."}),"\n",(0,s.jsx)(n.li,{children:'REST: This attribute can customize the API according to JSON values. The "method" is the request method and the "path" is the routing URL address.'}),"\n",(0,s.jsxs)(n.li,{children:['Trigger\uff1aThis attribute can customize the trigger according to JSON values. The "listenTo" is the object being listened to, and the "when" is the triggering timing. Detailed values can be found in the trigger section of the official documentation of the Steedos platform:',(0,s.jsx)(n.a,{href:"https://beta.steedos.cn/docs/developer/action-trigger",children:"https://beta.steedos.cn/docs/developer/action-trigger"})]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"When the node receives input messages, it sends the data in the messages as parameters for the request to the Steedos platform and sends the response data as output messages to the next node. You can find more information about this in the steedos-template project."}),"\n",(0,s.jsx)(n.p,{children:"For example, you can customize an API in Node-RED with Steedos Request."}),"\n",(0,s.jsxs)(n.p,{children:["The API Endpoint:",(0,s.jsx)(n.a,{href:"http://127.0.0.1:5000/service/api/example-service/hello/jack",children:"http://127.0.0.1:5000/service/api/example-service/"}),"+path"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:t(97120).A+"",width:"516",height:"537"})}),"\n",(0,s.jsx)(n.p,{children:"Example\uff1a"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:t(59358).A+"",width:"513",height:"502"})}),"\n",(0,s.jsx)(n.h3,{id:"steedos-response",children:"steedos-response"}),"\n",(0,s.jsx)(n.p,{children:"Steedos Response is a Node-RED node used for sending response messages to the initiator of an HTTP request. This node requires the following parameters to be configured:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Name: The name of the node, used to identify the node within Node-RED."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"When the node receives input messages, it sends the data in the messages back to the initiator of the HTTP request as the response body. The options of the node can be configured to set the status code, HTTP headers, and content type of the response. This node is typically used in conjunction with the Steedos Request node to respond to requests from the ObjectQL microservices and GraphQL microservices of the Steedos platform. More details can be found in the steedos-template project."}),"\n",(0,s.jsx)(n.h3,{id:"steedos-api-gw",children:"steedos-api-gw"}),"\n",(0,s.jsx)(n.p,{children:"Steedos API Gateway (APIGW) is an open-source API gateway in Steedos that helps enterprises integrate multiple microservices into a unified API."}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"Broker"}),":refers"," to the message broker"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"Name"}),"\uff1aspecifies the name of the node"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"Action"}),": is the name of the operation to be performed"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"It provides a range of functionalities, such as API management, security authentication, traffic control, logging, and monitoring. In Steedos, APIGW is an independent service that can be configured through configuration files and used in conjunction with other services. This node requires the following parameters. More details can be found in the steedos-template project."}),"\n",(0,s.jsx)(n.h3,{id:"steedos-instance",children:"steedos-instance"}),"\n",(0,s.jsx)(n.p,{children:"Steedos Instance is a Node-RED node that allows you to inject a Steedos instance into the flow or global context. It enables you to perform various operations using the API of the Steedos platform, such as querying, creating, updating, and deleting data."}),"\n",(0,s.jsx)(n.p,{children:"Before using the Steedos Instance node, you need to create an application on the Steedos platform and configure its data model. Then, you need to specify the name of the application and the access token in the configuration of the Steedos Instance node. This way, when you call the Steedos instance in the flow or global context, it will automatically authenticate you with the credentials you provide and allow you to perform application-related operations. More details can be found in the steedos-template project."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:t(22489).A+"",width:"492",height:"373"})}),"\n",(0,s.jsx)(n.h2,{id:"to-invoke-graphql",children:"To invoke GraphQL"}),"\n",(0,s.jsx)(n.p,{children:"use msg.call in your Node-RED flow."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-jsx",children:'msg.call(\'api.graphql\', \n    {\n        query: `query {\n            space_users(filters: ["user", "=", "${msg.meta.user.userId}"]) {\n                name\n                organization\n            }\n        }`\n    }, \n    { meta: { } }\n).then((data) => {\n    msg.payload = data\n    node.send(msg)\n}).catch((err) => {\n    node.error(err, msg)\n})        \n'})}),"\n",(0,s.jsx)(n.h2,{id:"to-invoke-objectql",children:"To invoke ObjectQL"}),"\n",(0,s.jsx)(n.p,{children:"There are two ways to invoke ObjectQL in Node-RED:"}),"\n",(0,s.jsx)(n.h3,{id:"invoke-using-msgcall",children:"Invoke using msg.call"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-jsx",children:'msg.call(\'objectql.find\',\n    {\n        "objectName": "space_users",\n        "query": {\n            // "fields": ["name", "orgranizations"],\n            "filters": ["user", "=", msg.meta.user.userId]\n        }\n    },\n    { meta: {} }\n).then((data) => {\n    msg.payload = data\n    node.send(msg)\n}).catch((err) => {\n    node.error(err, msg)\n})\n'})}),"\n",(0,s.jsx)(n.h3,{id:"invoke-using-a-broker",children:"Invoke using a broker"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'const broker = global.get(\'broker\');\n\nmsg.payload = await broker.call(\'objectql.find\', \n    {\n        "objectName": "space_users",\n        "query": {\n            "fields": ["name", "organizations"]\n        }\n    },\n    { meta: {} }\n)\n'})}),"\n",(0,s.jsx)(n.h2,{id:"trigger",children:"Trigger"}),"\n",(0,s.jsx)(n.p,{children:"Example\uff1a"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:t(10893).A+"",width:"1080",height:"370"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'[\n{\n"id": "7350d7b42b233ab6",\n"type": "steedos-request-action",\n"z": "c10017b236a162fd",\n"broker": "ce147b46c731d342",\n"service": "5ab5acead56ffaea",\n"name": "trigger",\n"topic": "space_users_triggers",\n"rest": "{}",\n"restType": "json",\n"trigger": "{\\"listenTo\\":\\"space_users\\",\\"when\\":[\\"beforeInsert\\",\\"beforeUpdate\\"]}",\n"triggerType": "json",\n"params": "{}",\n"paramsType": "json",\n"x": 100,\n"y": 120,\n"wires": [\n[\n"0441d3a1237dcd50",\n"6f988203ee0b8323"\n]\n]\n},\n{\n"id": "0441d3a1237dcd50",\n"type": "function",\n"z": "c10017b236a162fd",\n"name": "trigger",\n"func": "const doc = msg.payload.doc;\\nif ([doc.name](http://doc.name/) && doc.name.length < 2) {\\n   msg.error = { message: \\"\u59d3\u540d\u6700\u5c11\u4e24\u4f4d.\\" };\\n}\\n\\nreturn msg;",\n"outputs": 1,\n"noerr": 0,\n"initialize": "",\n"finalize": "",\n"libs": [],\n"x": 350,\n"y": 160,\n"wires": [\n[\n"dd4a70227645def5",\n"1a4631e22fdbdc5d"\n]\n]\n},\n{\n"id": "dd4a70227645def5",\n"type": "debug",\n"z": "c10017b236a162fd",\n"name": "debug 5",\n"active": true,\n"tosidebar": true,\n"console": false,\n"tostatus": false,\n"complete": "error",\n"targetType": "msg",\n"statusVal": "",\n"statusType": "auto",\n"x": 680,\n"y": 80,\n"wires": []\n},\n{\n"id": "1a4631e22fdbdc5d",\n"type": "steedos-response-action",\n"z": "c10017b236a162fd",\n"name": "",\n"x": 700,\n"y": 220,\n"wires": []\n},\n{\n"id": "6f988203ee0b8323",\n"type": "debug",\n"z": "c10017b236a162fd",\n"name": "debug 6",\n"active": true,\n"tosidebar": true,\n"console": false,\n"tostatus": false,\n"complete": "payload",\n"targetType": "msg",\n"statusVal": "",\n"statusType": "auto",\n"x": 340,\n"y": 60,\n"wires": []\n},\n{\n"id": "ce147b46c731d342",\n"type": "steedos-config",\n"name": "steedos",\n"transporter": "${TRANSPORTER}",\n"namespace": "steedos",\n"options": "{}",\n"optionsType": "json"\n},\n{\n"id": "5ab5acead56ffaea",\n"type": "steedos-service-config",\n"name": "example-nodered",\n"version": "",\n"settings": "{}",\n"rest": "",\n"settingsType": "json"\n}\n]\n'})})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},62738:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/node_red_emit-29955bd9294885f17cf2eed304685935.png"},90803:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/node_red_event-78ce44ace55234ec2581600a0c05f267.png"},22489:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/node_red_gw-e2e27700758235cdbfd1a6d5c0588bc3.png"},17605:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/node_red_ini-bfe9945e10eab38eda565602e9ec69bb.png"},10893:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/node_red_objectql-926400805a4e3413352d086203e3276b.png"},97120:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/node_red_request-200f73b055c328df7566ad09c70e70dd.png"},59358:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/node_red_request_ex-b4b5f1d2b81008d3e8d0b640b70f4d27.png"},89892:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/node_red_run-9a6935e2c40d4f371de149c2a1bd4226.png"},28453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>a});var s=t(96540);const o={},i=s.createContext(o);function r(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);